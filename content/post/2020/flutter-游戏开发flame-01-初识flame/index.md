---
title: "Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»"
date: "2020-04-16"
categories: 
  - "flame-tutorials"
  - "flutteræ¸¸æˆå¼€å‘"
tags: 
  - "flame"
  - "flutter"
  - "æ¸¸æˆå¼€å‘"
coverImage: "photo-of-white-wall-1484759.png"
---

å¦‚æœä½ å¯¹Flutteræœ‰ä¸€å®šçš„äº†è§£, é‚£ä¹ˆåº”è¯¥çŸ¥é“å®ƒå¯ä»¥åŒæ—¶è½¬ä¸ºAndroidã€IOS APP. å¹¶ä¸”ä¼šåœ¨åç»­çš„ç‰ˆæœ¬æ”¯æŒWebã€Macä»¥åŠWindowsè®¾å¤‡.

é‚£ä¹ˆ, ç”¨Flutterå¼€å‘æ¸¸æˆä¼¼ä¹æ˜¯ä¸€ä»¶å¾ˆæ£’çš„äº‹æƒ…ğŸ˜ğŸ˜.

> æˆ‘åœ¨ã€Š[Flutterå¯ä»¥å¼€å‘æ¸¸æˆå•¦! Flameæ¸¸æˆå¼€å‘æ¡†æ¶æµ‹è¯„](https://www.bugcatt.com/archives/4)ã€‹ä¸­ç®€å•çš„å¯¹Flutterçš„Flameæ¡†æ¶è¿›è¡Œäº†æµ‹è¯„.

æœ‰äº›æœ‹å‹å¸Œæœ›è¿›ä¸€æ­¥åœ¨Flutterä¸Šå‘å±•, å¹¶ä¸”åˆ›å»ºå±äºè‡ªå·±çš„æ¸¸æˆ. è‹¥ä½ æ˜¯è¿™ä¸€ç±»äºº, é‚£ä¹ˆæœ¬åšå®¢åº”è¯¥æ˜¯ä½ ä¸é”™çš„é€‰æ‹©. æœ¬æ•™ç¨‹å°†ä¼šæŠŠé‡å¿ƒæ”¾åœ¨æ¦‚å¿µä¸Š, è€Œä¸æ˜¯ç«‹åˆ»åˆ¶ä½œä¸€ä¸ªç²¾ç¾ã€å¯ä¸Šçº¿çš„æ¸¸æˆ.

å¦‚æœå¯¹åšå®¢æœ‰ä»»ä½•é—®é¢˜, æ¬¢è¿åœ¨ä¸‹æ–¹ç•™è¨€, é˜¿èˆªä¼šå°½åŠ›ã€å°½å¿«å›å¤ğŸ™‚.

## å¼€å‘ç¯å¢ƒ

æœ¬åšå®¢çš„ç¯å¢ƒä¸€è§ˆ:

| ç¯å¢ƒ | ç‰ˆæœ¬å· |
| --- | --- |
| Flutter | 1.14.6 beta |
| Dart | 2.8.0-dev.5.0 |
| Android Studio | 3.5.2 |

ğŸ”´æ³¨æ„: æ£€æŸ¥ä½ çš„ç¯å¢ƒå’Œæ–‡ä¸­çš„å·®å¼‚, ä»¥é¿å…å‡ºç°ä¸å…¼å®¹çš„æƒ…å†µ

## éœ€å…·å¤‡çš„æ¡ä»¶

æœ¬æ–‡å°†å‡è®¾æ‚¨å·²æ˜¯ä¸€åæœ‰ä¸€å®šç»éªŒçš„å¼€å‘äººå‘˜, ä¸”æ‹¥æœ‰äº†"ç¨‹åºå‘˜æ€ç»´". å¦‚æœä½ æ˜¯å°ç™½, æ²¡å…³ç³»! æœ¬ç¯‡æ•™ç¨‹éå¸¸å…¥é—¨. åªè¦å…´è¶£è¶³å¤Ÿ, ä½ ä¹Ÿå°†æˆä¸ºä¸€å"æ¸¸æˆå¼€å‘è€…".

ä½ ä¹Ÿéœ€è¦ä¸€ä¸ªé…ç½®è¶³å¤Ÿçš„ç”µè„‘, å¯ä»¥è¿è¡ŒIDEã€ç¼–è¯‘å¹¶è¿è¡ŒAndroidæ¨¡æ‹Ÿå™¨. å¦‚æœä½ çš„ç”µè„‘é…ç½®ä¸å¤Ÿé«˜, ä½ ä¹Ÿå¯ä»¥ç›´æ¥è¿æ¥Androidæ‰‹æœº, åœ¨çœŸæœºä¸Šè¿è¡Œå’Œè°ƒè¯•.

Flutterå¯ä»¥åŒæ—¶æ„å»ºAndroidå’ŒIOS APP. æœ¬æ–‡å°†å›´ç»•Androidè¿›è¡Œå¼€å‘. å¼€å‘å®Œæˆå, ä½ å¯ä»¥è¿è¡Œä¸åŒçš„build, ä½¿ä½ ä¹Ÿå¯ä»¥åœ¨IOSä¸Šç©æ¸¸æˆ.

è¦é¡ºåˆ©é˜…è¯»æœ¬æ–‡, å‡å®šæ‚¨å·²ç»å…·å¤‡ä»¥ä¸‹æ¡ä»¶:

1. IDE (Android Studio æˆ–è€… Microsoft Visual Studio), ä»¥åŠå…¶æ‰€éœ€çš„Flutterå’Œdartæ’ä»¶
2. Android SDK. è¿™æ˜¯å¼€å‘Androidåº”ç”¨çš„å¿…å¤‡æ¡ä»¶.
3. Flutter SDK. æœ¬ç¯‡å°†ä½¿ç”¨Flutterä»¥åŠFlameè¿›è¡Œæ¸¸æˆå¼€å‘. è¯·é˜…è¯»[Flutterå®˜æ–¹æ–‡æ¡£](https://flutterchina.club/get-started/install/), å®Œæˆåœˆå†…çš„æ•™ç¨‹

<figure>

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/Flutterå®˜ç½‘æˆªå›¾-1024x399.png)

<figcaption>

æ¡ä»¶3: å®ŒæˆFlutterå®˜æ–¹æ–‡æ¡£ä¸­çš„å‰ä¸‰æ­¥

</figcaption>

</figure>

* * *

## æ‰‹æ¸¸åˆ¶ä½œå¼€å§‹

æˆ‘ä»¬å°†ä¼šä»å…¥é—¨å¼€å§‹æ•™å­¦(éå¸¸ç®€å•). æˆ‘ä»¬è¦åˆ¶ä½œçš„æ¸¸æˆä¸ºé»‘è‰²èƒŒæ™¯, ä¸­é—´æœ‰ä¸€ä¸ªç™½è‰²æ–¹å—, ç‚¹å‡»æ–¹å—, æ–¹å—é¢œè‰²å°†å˜ä¸ºç»¿è‰²å¹¶è·å¾—æ¸¸æˆèƒœåˆ©.

æˆ‘ä»¬ä¸ä¼šä¸ºæ­¤æ¸¸æˆä½¿ç”¨ä»»ä½•å¤–éƒ¨çš„èµ„æºæ–‡ä»¶(å›¾ç‰‡)

æœ¬æ•™ç¨‹çš„å…¨éƒ¨ä»£ç éƒ½å°†å­˜å‚¨åœ¨Githubä»¥åŠGiteeä¸Š, ä½ å¯ä»¥éšæ—¶æŸ¥çœ‹å’Œä¸‹è½½.

## åˆ›å»ºä¸€ä¸ªFlutter APP

### åˆ›å»ºFlutteré¡¹ç›®:boxgame

æ‰“å¼€ç»ˆç«¯(CMD/å‘½ä»¤æç¤ºç¬¦), è¾“å…¥:

```
flutter create boxgame
```

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨é™¤boxgameå¤–å…¶ä»–çš„åç§°. ä½†ç¡®ä¿å°†æ‰€æœ‰boxgameæ›¿æ¢ä¸ºä½ è‡ªå·±çš„åç§°.

### è¿è¡Œboxgame

ä½¿ç”¨ä½ çš„IDEæ‰“å¼€åˆšç”Ÿæˆçš„boxgameç›®å½•, æˆ–è€…è¾“å…¥ä»¥ä¸‹å‘½ä»¤ç«‹åˆ»è¿è¡Œä½ çš„APP:

```
cd boxgame
```

```
flutter run
```

é¦–æ¬¡è¿è¡Œæ–°åˆ›å»ºçš„åº”ç”¨å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´, å½“APPè¿è¡Œæ—¶, åº”è¯¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-15_095531-1019x757.png)

> ğŸŸ¡æç¤º: ä½ éœ€è¦ä½¿ç”¨å®‰å“æ¨¡æ‹Ÿå™¨, æˆ–è€…å¯ç”¨äº†USBè°ƒè¯•çš„å®‰å“è®¾å¤‡è¿è¡ŒAPP

### æœ¬æ­¥éª¤ä»£ç (åˆ›å»ºFlutter APP)

åœ¨[Github](https://github.com/HarrisonQi/flame-tutorial-boxgame/tree/6d6d957f6a412e62a3571546315fdda91c62ee4f)æˆ–[ç äº‘](https://gitee.com/HarrisonQI/flame-tutorial-boxgame/tree/6d6d957f6a412e62a3571546315fdda91c62ee4f)æŸ¥çœ‹æœ¬é˜¶æ®µçš„ä»£ç .

## å®‰è£…Flameæ’ä»¶, æ¸…ç†ä»£ç 

> ğŸŸ¡æç¤º: ä»ç°åœ¨å¼€å§‹, æˆ‘ä»¬å°†é¡¹ç›®ç›®å½•ç§°ä¸º `./`.  
> æ¯”å¦‚ä½ çš„é¡¹ç›®ç›®å½•ä¸º`/home/handsomeme/boxgame`,  
> `./lib/main.dart`åˆ™æ˜¯æŒ‡`/home/handsomeme/boxgame/lib/main.dart`

å¯åŠ¨ä½ çš„IDE, æ‰“å¼€æˆ‘ä»¬åˆ›å»ºçš„boxgameé¡¹ç›®.

æˆ‘ä»¬å³å°†ä½¿ç”¨**Flame**æ’ä»¶, æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†å…¶æ·»åŠ åˆ°ä¾èµ–ä¸­. æ‰¾åˆ° `./pubspec.yaml` åœ¨`cupertino_icons`ä¸‹æ·»åŠ ä»¥ä¸‹è¡Œ(æ³¨æ„ç¼©è¿›):

```
flame: ^0.18.1
```

<figure>

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-15_145055-818x416.png)

<figcaption>

æ·»åŠ flameç¬¬ä¸‰æ–¹åº“

</figcaption>

</figure>

ğŸŸ¢è¿›è¡Œ `packages get`

> ğŸŸ¡æç¤º: å¦‚æœä½ çš„IDEæ˜¯VSCode,IDEä¼šåœ¨ä½ ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨å®‰è£…ç¬¬ä¸‰æ–¹åº“. Android Studio: ç‚¹å‡»ä¸Šæ–¹çš„`packages get`æŒ‰é’®è¿›è¡ŒåŒ…æ›´æ–°. å…¶ä»–æƒ…å†µ: åœ¨ç»ˆç«¯ä¸­è¾“å…¥`flutter packages get`è¿›è¡ŒåŒ…æ›´æ–°
> 
> åç»­çš„`packages get`å°†ä¸å†èµ˜è¿°!

æˆ‘ä»¬æ¥ä¸‹æ¥æ¸…ç†flutterçš„é¢„è®¾æ–‡ä»¶å†…å®¹, æ›¿æ¢`./lib/main.dart`ä¸º:

```
import 'package:flutter/material.dart';

void main() {}
```

> ğŸ’¡ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªç•™äº†ä¸€è¡Œ: void main() {}, é™¤æ­¤ä¹‹å¤–ä¿ç•™äº†importè¯­å¥, å› ä¸ºæˆ‘ä»¬åé¢å°†ä¼šä½¿ç”¨material.

ä»£ç æˆªå›¾:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-15_115134-955x458.png)

æˆ‘ä»¬åŒæ ·éœ€è¦åˆ é™¤`./test`ç›®å½•, å› ä¸ºæˆ‘ä»¬æš‚æ—¶ç”¨ä¸ä¸Š.

### æœ¬æ­¥éª¤ä»£ç (å®‰è£…FlameåŠæ¸…ç†ä»£ç )

åœ¨[Github](https://github.com/HarrisonQi/flame-tutorial-boxgame/tree/e0dc1d271aa5f3ad4ff26a92d591d044a4e1ef86)æˆ–[ç äº‘](https://gitee.com/HarrisonQI/flame-tutorial-boxgame/tree/e0dc1d271aa5f3ad4ff26a92d591d044a4e1ef86)æŸ¥çœ‹æœ¬é˜¶æ®µçš„ä»£ç .

## åˆ›å»ºgame loop(æ¸¸æˆå¾ªç¯)

### ä½•ä¸ºgame loop?

game loopæ˜¯ä¸€æ¬¾æ¸¸æˆçš„æœ¬è´¨, ä¸€ç»„åå¤è¿è¡Œçš„ä»£ç .

æœ‰ä¸€ä¸ªå¾ˆå¸¸è§çš„å«æ³•:**FPS**. å®ƒä»£è¡¨æ¯ç§’çš„å¸§æ•°, è¿™æ„å‘³ç€, è‹¥ä½ çš„æ¸¸æˆæ˜¯60fps, é‚£ä¹ˆgame loopå°†åœ¨æ¯ç§’å¾ªç¯60æ¬¡!

ç®€è€Œè¨€ä¹‹: ä¸€å¸§ = ä¸€æ¬¡game loop

ä¸€ä¸ªåŸºæœ¬çš„game loopç”±ä¸¤éƒ¨åˆ†ç»„æˆ, `update`(æ›´æ–°)å’Œ`render`(æ¸²æŸ“)

è¿™é‡Œå¼•ç”¨äº†å®˜æ–¹çš„å›¾ç‰‡, é˜¿èˆªå¯¹æ­¤è¿›è¡Œäº†ç¿»è¯‘, ä¾¿äºå„ä½ç†è§£:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/å›¾ç‰‡2-1024x399.png)

updateéƒ¨åˆ†ç”¨äºå¤„ç†å¯¹è±¡(æ¯”å¦‚ç©å®¶çš„è§’è‰², æ•Œäºº, éšœç¢ç‰©, åœ°å›¾)å’Œå…¶ä»–éœ€è¦æ›´æ–°çš„ä¸œè¥¿(æ¯”å¦‚è®¡æ—¶å™¨)çš„åŠ¨ä½œ. å¤§å¤šæ•°åŠ¨ä½œéƒ½ä¼šåœ¨è¿™é‡Œå‘ç”Ÿ. æ¯”å¦‚è®¡ç®—æ•Œäººæ˜¯å¦è¢«å­å¼¹æ‰“ä¸­, æˆ–è®¡ç®—æ•Œäººæ˜¯å¦ç¢°åˆ°äº†ç©å®¶è§’è‰²(ç©å®¶é€šå¸¸ä¼šä¸å–œæ¬¢çš„ğŸ¤£).

### æ¸²æŸ“å‰åŒæ­¥æ‰§è¡Œä»£ç 

æ¸²æŸ“éƒ¨åˆ†åœ¨å±å¹•ä¸Šç»˜åˆ¶æ‰€æœ‰å¯¹è±¡, è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹, å› æ­¤æ‰€æœ‰å†…å®¹éƒ½å¯ä»¥synchronized(åŒæ­¥/é¡ºåº)è¿›è¡Œ.

é‚£ä¹ˆ, ä¸ºä½•éœ€è¦synchronized?  
å¦‚æœä½ äº†è§£å‰ç«¯å¼€å‘, åº”è¯¥ä¼šå¾ˆå¿«äº†è§£. å‰ç«¯çš„å¤§éƒ¨åˆ†åŠ¨ä½œéƒ½æ˜¯asynchronous(å¼‚æ­¥)è¿›è¡Œçš„. ä½†æ˜¯åˆ°éœ€è¦å¼ºè°ƒè¿è¡Œé¡ºåº(æ¯”å¦‚è°ƒç”¨ç½‘ç»œæ¥å£, è·å–æ•°æ®åå†æ¸²æŸ“)æ—¶, å°±éœ€è¦synchronizedè¿›è¡Œ.

æˆ‘ä»¬éœ€è¦å…ˆè®¡ç®—æ‰€æœ‰éœ€è¦è®¡ç®—çš„å†…å®¹, è®¡ç®—å®Œæˆå, å†æ¸²æŸ“å±å¹•.

### ä½¿ç”¨Flameæ›¿æˆ‘ä»¬å¤„ç†åŒæ­¥âœŒ

**Flame**æ¡†æ¶å·²ç»æœ‰å¤„ç†åŒæ­¥çš„ä»£ç , æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä¸“æ³¨äºupdateä»¥åŠrenderçš„è¿‡ç¨‹!

### å…¨å±å¤„ç†/é”å®šå±å¹•æ—‹è½¬

åœ¨é¦–è¡Œå¯¼å…¥:

```
import 'package:flame/util.dart';
import 'package:flutter/services.dart';
```

åœ¨`main()`ä¸­, åˆ›å»ºä¸€ä¸ª`Flame`çš„`Util` class. è°ƒç”¨å®ƒçš„`fullscreen`å’Œ`setOrientation`å‡½æ•°, å¹¶åŠ ä¸Š`await`å…³é”®å­—, è®©å…¶åŒæ­¥è¿›è¡Œ.

```
WidgetsFlutterBinding.ensureInitialized();
Util flameUtil = Util(); 
await flameUtil.fullScreen(); 
await flameUtil.setOrientation(DeviceOrientation.portraitUp);
```

> ğŸŸ¡æç¤º: Futureã€asyncå’Œawaitéƒ½æ˜¯ä½ åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­, éœ€è¦ç­‰å¾…æŸå‡½æ•°å®Œæˆçš„å…³é”®å­—, ä½†ä¸ä¼šé˜»å¡å…¶ä»–è¿›ç¨‹. å¦‚æœä½ æƒ³è¯¦ç»†äº†è§£, å¯ä»¥è®¿é—®[Dartå®˜ç½‘](https://www.dartlang.org/tutorials/language/futures)

é™¤æ­¤ä»¥å¤–, æˆ‘ä»¬è¿˜éœ€è¦ä¸ºmain()æ·»åŠ asynå…³é”®å­—, ä½¿å†…éƒ¨çš„å‡½æ•°åŒæ­¥è¿›è¡Œ:

```
void main() async {
```

ä»£ç æˆªå›¾:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-15_141757-987x508.png)

### åˆ›å»ºgame loop

è‹¥è¦ä½¿ç”¨Flameæä¾›çš„game loopè„šæ‰‹æ¶, æˆ‘ä»¬å¿…é¡»åˆ›å»ºFlameçš„`Game`ç±»çš„å­ç±». ä¸ºæ­¤, åœ¨ `./lib`ä¸‹åˆ›å»ºåä¸º`box-game.dart`çš„æ–‡ä»¶.

åˆ›å»ºä¸€ä¸ªåä¸º`BoxGame`çš„class, å¹¶ç»§æ‰¿`flame`çš„Game:

```
import 'dart:ui';

import 'package:flame/game.dart';

class BoxGame extends Game {
  void render(Canvas canvas) {
    // TODO: implement render
  }

  void update(double t) {
    // TODO: implement update
  }
}
```

> ğŸ’¡ ä»£ç è§£æ: é¦–å…ˆå¯¼å…¥Dartçš„`ui`åº“, ä»¥ä¾¿ä½¿ç”¨`Canvas`ç±», ç„¶åå†ä½¿ç”¨`Size`ç±». ç„¶åæˆ‘ä»¬å¯¼å…¥Flameçš„`game`åº“, å…¶ä¸­åŒ…æ‹¬æˆ‘ä»¬è¦æ‰©å±•çš„`Gameç±»`. å…¶ä»–å°±æ˜¯æˆ‘ä»¬ä»çˆ¶ç±»(æˆ–è¶…ç±»)ä¸­ç»§æ‰¿çš„ä¸¤ä¸ªå‡½æ•°: `update()`å’Œ`render()`. è¿™äº›å‡½æ•°ä¼šè¦†ç›–åŒåçš„çˆ¶ç±»å‡½æ•°(ä¹Ÿå°±æ˜¯é‡å†™).

ğŸŸ¡ `@override`æ³¨è§£åœ¨Dart 2ä¸­ä¸æ˜¯å¿…éœ€çš„. new å…³é”®å­—ä¹Ÿæ˜¯éå¿…é¡»çš„.  
æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œæ²¡æœ‰å†™å‡ºæ¥.

### å®Œæˆæ¸¸æˆéª¨æ¶

ä¸‹ä¸€æ­¥å°±æ˜¯æ¥åˆ›å»º`BoxGame`çš„ç±»å®ä¾‹, å¹¶å°†å…¶`widget`å±æ€§ä¼ é€’ç»™`runApp`.

è¿”å›`./lib/main.dart`, åœ¨æ–‡ä»¶é¡¶éƒ¨å¯¼å…¥:

```
import 'package:boxgame/box-game.dart';
```

> ğŸ’¡ ä»£ç è§£æ: è¯¥è¡Œç¡®ä¿å¯ä»¥åœ¨**main.dart**ä¸­ä½¿ç”¨**BoxGame**ç±».

æ¥ä¸‹æ¥åˆ›å»º`BoxGame`çš„ç±»å®ä¾‹, å¹¶å°†å…¶`widget`å±æ€§ä¼ é€’ç»™runApp(). åœ¨`main()`ä¸­çš„æœ«å°¾(åœ¨"}"å‰)æ’å…¥:

```
BoxGame game = BoxGame();
runApp(game.widget);
```

æŸäº›ç‰ˆæœ¬ç›´æ¥è¿è¡Œä¼šæŠ¥é”™`Unhandled Exception: ServicesBinding.defaultBinaryMessenger was accessed before the binding was initialized.`

æ‰€ä»¥åœ¨main()é¦–è¡Œæ·»åŠ :

```
WidgetsFlutterBinding.ensureInitialized();
```

éº»é›€è™½å°, äº”è„ä¿±å…¨. ç°åœ¨**æˆ‘ä»¬çš„é¡¹ç›®å¯ä»¥ç§°ä¹‹ä¸ºæ¸¸æˆäº†**.

å¦‚æœä½ å°è¯•è¿è¡Œapp, ç•Œé¢åº”è¯¥æ˜¯é»‘è‰²çš„. å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰renderä»»ä½•ä¸œè¥¿å‘¢!

main.dartä»£ç æˆªå›¾:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-15_145421-945x365.png)

### æœ¬æ­¥éª¤ä»£ç (game loop)

åœ¨[Github](https://github.com/HarrisonQi/flame-tutorial-boxgame/tree/e974dab3d7696c45d5b3a326323c9df59a56b30a)æˆ–[ç äº‘](https://gitee.com/HarrisonQI/flame-tutorial-boxgame/tree/e974dab3d7696c45d5b3a326323c9df59a56b30a)æŸ¥çœ‹æœ¬é˜¶æ®µçš„ä»£ç .

ğŸ”´ åœ¨æ–°ç‰ˆçš„Flutterä¸­å˜æ›´äº†main(), è‹¥å‡ºç°é—®é¢˜, æˆ‘ä»¬å¯ä»¥å˜æ›´ä»£ç è¡Œé¡ºåºè§£å†³è¿™ä¸ªé—®é¢˜:

```
void main() {
  BoxGame game = BoxGame();
  runApp(game.widget);

  Util flameUtil = Util();
  flameUtil.fullscreen();
  flameUtil.setOrientation(DeviceOrientation.portraitUp);
}
```

> ğŸ’¡ è¿™æ ·, å°±ä¸éœ€è¦ä½¿ç”¨awaitå…³é”®å­—äº†. ä¹Ÿå¯ä»¥é¡ºä¾¿ç§»é™¤asyncå…³é”®å­—.

## ç»˜åˆ¶å±å¹•

åœ¨ç»˜åˆ¶å‰, æˆ‘ä»¬éœ€è¦çŸ¥é“å±å¹•çš„å°ºå¯¸. Flutteråœ¨å±å¹•ä¸Šç»˜åˆ¶æ—¶ä¼šä½¿ç”¨é€»è¾‘åƒç´ , æ‰€ä»¥ç›®å‰ä¸å¿…æ‹…å¿ƒè°ƒæ•´æ¸¸æˆå¯¹è±¡å°ºå¯¸çš„å¤§å°.

1è‹±å¯¸çš„è®¾å¤‡å¤§çº¦åŒ…å«96ä¸ªé€»è¾‘åƒç´ . å¤šæ•°ä¸»æµæ‰‹æœºçš„å°ºå¯¸ç±»ä¼¼, åŠ ä¸Šæˆ‘ä»¬çš„æ¸¸æˆæ¯”è¾ƒç®€å•, æ‰€ä»¥æˆ‘ä»¬ä¸å¿…æ‹…å¿ƒå°ºå¯¸çš„é—®é¢˜.

FlameåŸºäºè¿™ä¸ªå°ºå¯¸ç³»ç»Ÿä¸Š. Gameç±»æä¾›äº†å¯ä¾›é‡å†™çš„è°ƒæ•´å°ºå¯¸çš„å‡½æ•°, æ­¤å‡½æ•°æ¥å—Sizeä½œä¸ºå‚æ•°, æˆ‘ä»¬æ ¹æ®æ­¤å‚æ•°ç¡®å®šå±å¹•å°ºå¯¸(å•ä½æ˜¯é€»è¾‘åƒç´ ).

é¦–å…ˆ, åœ¨classä¸­å£°æ˜ä¸€ä¸ªå˜é‡, æ­¤å˜é‡(ä¹Ÿç§°ä½œå®ä¾‹å˜é‡)å°†ä¿å­˜å±å¹•å°ºå¯¸, ä¸”ä»…åœ¨å±å¹•å°ºå¯¸å˜æ›´æ—¶é‡æ–°èµ‹å€¼(å¯¹äºæˆ‘ä»¬çš„æ¸¸æˆä»…å‘ç”Ÿä¸€æ¬¡). è¿™ä¹Ÿæ˜¯å±å¹•ä¸Šç»˜åˆ¶å¯¹è±¡çš„åŸºç¡€. æ­¤å˜é‡çš„ç±»å‹åº”è¯¥ä¸ºSize. ä¸ä¼ é€’ç»™resize()çš„å†…å®¹ç›¸ä¼¼:

```
class BoxGame extends Game {
  Size screenSize;
```

> ğŸ’¡ ä»£ç è§£æ: screenSizeå°†è¢«åˆå§‹åŒ–ä¸ºnull. è¿™ä¹ˆå†™å¯¹åç»­æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦çŸ¥é“æ¸²æŸ“æœŸé—´å±å¹•çš„å¤§å°æ—¶æœ‰å¸®åŠ©. åé¢ä¼šè¯¦ç»†ä»‹ç».

æ¥ä¸‹æ¥åœ¨`./lib/box-game.dart`ä¸­é‡å†™`resize()`:

```
void resize(Size size) {
  screenSize = size;
  super.resize(size);
}
```

> ğŸ’¡ ä»£ç è§£æ1: çˆ¶ç±»çš„resize()å®é™…ä¸Šæ˜¯ç©ºçš„, å¦‚æœæˆ‘ä»¬ä¸æ‰“ç®—å®Œå…¨é‡å†™è¯¥åŠŸèƒ½, éœ€è¦è°ƒç”¨ä¸€æ¬¡çˆ¶ç±»çš„å‡½æ•°.

> ğŸ’¡ ä»£ç è§£æ2: å®ä¾‹å˜é‡æ˜¯å¯ä»è¯¥ç±»çš„æ‰€æœ‰å‡½æ•°ä¸­è®¿é—®çš„å˜é‡. æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è°ƒæ•´å®ƒçš„å¤§å°, å¹¶åœ¨renderæ—¶è·å–è¯¥å€¼.

ä»£ç æˆªå›¾:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-15_153842-745x485.png)

### Canvaså’ŒèƒŒæ™¯

è‡³æ­¤, Game loopå·²åˆ›å»ºå®Œæˆ, å¯ä»¥å¼€å§‹è¿›è¡Œç»˜åˆ¶äº†. å¦‚æœä¸éœ€è¦æ›´æ–°æŸäº›æ•°æ®, ä¸ç”¨ç®¡updateå‡½æ•°.

åœ¨renderå‡½æ•°å†…éƒ¨, æˆ‘ä»¬éœ€è¦è®¿é—®Canvas. Flameå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹Canvasçš„æ”¯æŒ.

åœ¨ç»˜åˆ¶canvasæ—¶, **è®°ä½: è¦ä¸€ç›´ä¼˜å…ˆç»˜åˆ¶æœ€åº•éƒ¨çš„å¯¹è±¡.** åç»­ç»˜åˆ¶çš„å¯¹è±¡å°†è¦†ç›–åœ¨å·²æœ‰çš„å¯¹è±¡ä¸Šé¢.

### ç»˜åˆ¶èƒŒæ™¯

é¦–å…ˆæˆ‘ä»¬åœ¨å±å¹•ä¸Šç»˜åˆ¶ä¸€ä¸ªç®€å•çš„é»‘è‰²èƒŒæ™¯.

`render()`ä¸­æ·»åŠ :

```
Rect bgRect = Rect.fromLTWH(0, 0, screenSize.width, screenSize.height);
Paint bgPaint = Paint();
bgPaint.color = Color(0xff000000);
canvas.drawRect(bgRect, bgPaint);
```

> ğŸ’¡ è§£æ: ç¬¬1è¡Œå®šä¹‰äº†ä¸€ä¸ªå’Œå±å¹•åŒç­‰å¤§å°çš„çŸ©å½¢, å¹¶ä¸”è¾¹è·ä¸º0. ç¬¬2ã€3è¡Œå®šä¹‰äº†ä¸€ä¸ªPaintå¯¹è±¡, å¹¶ä¸”ä¸ºå…¶åˆ†é…äº†16è¿›åˆ¶ä¸”å¸¦é€æ˜åº¦çš„é¢œè‰². æœ€åä¸€è¡Œä½¿ç”¨äº†åœ¨å‰å‡ è¡Œå®šä¹‰çš„Rectå’ŒPaintå®ä¾‹, å¹¶åœ¨ç”»å¸ƒä¸Šç»˜åˆ¶.

ä»£ç æˆªå›¾:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-16_095227-992x508.png)

ğŸŸ¢ å°è¯•è¿è¡Œé¡¹ç›®, è‹¥ä½ çš„ä»£ç æ²¡æœ‰é—®é¢˜, ä¼šå±•ç¤ºä¸€ä¸ªå…¨é»‘çš„å±å¹•, ä½ ä¹Ÿå¯ä»¥å°è¯•ä¸åŒçš„èƒŒæ™¯è‰²!

### ç»˜åˆ¶target box(ç›®æ ‡æ–¹å—)

ä»ç„¶åœ¨`render()`ä¸­. æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨å±å¹•ä¸­å¤®ç»˜åˆ¶ä¸€ä¸ªç›®æ ‡æ–¹å—:

```
double screenCenterX = screenSize.width / 2;
double screenCenterY = screenSize.height / 2;
Rect boxRect = Rect.fromLTWH(
  screenCenterX - 75,
  screenCenterY - 75,
  150,
  150
);
Paint boxPaint = Paint();
boxPaint.color = Color(0xffffffff);
canvas.drawRect(boxRect, boxPaint);
```

> ğŸ’¡ è§£æ: å‰ä¸¤è¡Œé€šè¿‡è®¡ç®—ä½¿åæ ‡æ”¾åœ¨å±å¹•æ­£ä¸­å¤®. æ¥ä¸‹æ¥çš„å…­è¡Œåªå£°æ˜ä¸€ä¸ªå¤§å°ä¸º150Ã—150åƒç´ ï¼ˆé€»è¾‘ï¼‰çš„çŸ©å½¢ï¼Œå…¶åŸç‚¹ï¼ˆå·¦ä¸Šè§’ï¼‰ä½äºå±å¹•ä¸­å¿ƒï¼Œä½†å‘å·¦åç§»75åƒç´ ï¼Œå‘ä¸Šåç§»75åƒç´ .

ä»£ç æˆªå›¾:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-16_100653-964x762.png)

è¿è¡ŒAPP, å¯ä»¥çœ‹åˆ°ä¸­é—´å‡ºç°äº†ç™½è‰²å°æ–¹å—:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-16_100941-917x623.png)

### æœ¬æ­¥éª¤ä»£ç (ç»˜åˆ¶å±å¹•)

åœ¨[Github](https://github.com/HarrisonQi/flame-tutorial-boxgame/tree/c2fcacbd3d07be8fb75d41786840d3b947b5c965)æˆ–[ç äº‘](https://gitee.com/HarrisonQI/flame-tutorial-boxgame/tree/c2fcacbd3d07be8fb75d41786840d3b947b5c965)æŸ¥çœ‹æœ¬é˜¶æ®µçš„ä»£ç .

## å¤„ç†"ç”¨æˆ·è¾“å…¥åŠ¨ä½œ"ä»¥åŠ"æ¸¸æˆèƒœåˆ©"æ¡ä»¶

è·å®Œæˆä»…å‰©ä¸€æ­¥, æˆ‘ä»¬åªéœ€è¦å¤„ç†ç”¨æˆ·çš„è¾“å…¥åŠ¨ä½œ. è¿™é‡Œè¦ä½¿ç”¨Flutterçš„gesturesåŒ….

### å®šä¹‰å¤„ç†ç”¨æˆ·åŠ¨ä½œå‡½æ•°

é¦–å…ˆ, æˆ‘ä»¬åœ¨`lib/box-game.dart`ä¸­å¯¼å…¥:

```
import 'package:flutter/gestures.dart';
```

ä¹‹å, å®šä¹‰ä¸€ä¸ªå¤„ç†ç”¨æˆ·æŒ‰ä¸‹åŠ¨ä½œçš„å‡½æ•°:

```
void onTapDown(TapDownDetails d) {
  // handle taps here
}
```

### æ³¨å†ŒGestureRecognizer

è¿›å…¥`lib/main.dart`, æˆ‘ä»¬éœ€è¦åœ¨å…¶ä¸­æ³¨å†Œä¸€ä¸ª`GestureRecognizer`, å¹¶ä¸”ä¸æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„`onTapDown`è¿›è¡Œå…³è”.

å¯¼å…¥:

```
import 'package:flutter/gestures.dart';
```

åœ¨`BoxGame`ä¹‹å, å®šä¹‰`TapGestureRecognizer`, å¹¶ä¸”æŒ‡å®šå®ƒçš„`onTapDown`åˆ°æˆ‘ä»¬å®šä¹‰çš„`onTapDown`å¤„ç†å‡½æ•°ä¸Š

```
BoxGame game = BoxGame();
TapGestureRecognizer tapper = TapGestureRecognizer();
tapper.onTapDown = game.onTapDown;
flameUtil.addGestureRecognizer(tapper);
```

ä»£ç æˆªå›¾:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-16_102302-872x519.png)

### å¤„ç†"æ¸¸æˆèƒœåˆ©"

è¿”å›`./lib/box-game.dart`

æ·»åŠ ä¸€ä¸ªå®ä¾‹å˜é‡, ç”¨äºå¤„ç†"æ¸¸æˆèƒœåˆ©". ä¸€ä¸ªç®€å•çš„boolç±»å‹å°±å¯ä»¥, é»˜è®¤ä¸ºfalse:

```
bool hasWon = false;
```

åœ¨renderå‡½æ•°ä¸­, æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåˆ¤æ–­: è‹¥æ¸¸æˆèƒœåˆ©, æ–¹å—å˜ä¸ºç»¿è‰². åä¹‹ä¸ºç™½è‰²

```
// æ›¿æ¢æ‰ä¹‹å‰å®šä¹‰çš„ boxPaint.color = Color(0xffffffff);
if (hasWon) {
  boxPaint.color = Color(0xff00ff00);
} else {
  boxPaint.color = Color(0xffffffff);
}
```

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-16_102526-954x1044.png)

æˆ‘ä»¬æ¥åˆ¶å®šæ¸¸æˆè§„åˆ™: å¦‚æœç”¨æˆ·ç‚¹å‡»åˆ°äº†æ–¹å—èŒƒå›´, åˆ™åˆ¤å®šä¸ºèƒœåˆ©!

åœ¨`onTapDown`ä¸­æ·»åŠ :

```
double screenCenterX = screenSize.width / 2;
double screenCenterY = screenSize.height / 2;
if (d.globalPosition.dx >= screenCenterX - 75
  && d.globalPosition.dx <= screenCenterX + 75
  && d.globalPosition.dy >= screenCenterY - 75
  && d.globalPosition.dy <= screenCenterY + 75
) {
  hasWon = true;
}
```

> ğŸ’¡ è§£æ: è¿™æ®µä»£ç åœ¨è®¡ç®—ç‚¹å‡»ä½ç½®æ˜¯å¦åœ¨æ–¹æ ¼èŒƒå›´å†…

æ­¤æ—¶, å¦‚æœç”¨æˆ·ç‚¹å‡»äº†æ–¹å—èŒƒå›´å†…, `render`å°†ä¼šæ›´æ–°å˜é‡`hasWon`çš„å€¼

`onTapDown`å‡½æ•°æˆªå›¾:

![Flutter æ¸¸æˆå¼€å‘(flame) 00 Flameä»‹ç»](images/2020-04-16_102902-962x1130.png)

### å¤§åŠŸå‘Šæˆ

æˆ‘ä»¬å·²ç»æˆåŠŸçš„å®Œæˆäº†ä¸€ä¸ªæ¸¸æˆ! è¿è¡Œé¡¹ç›®, çœ‹çœ‹æ•ˆæœå§!

> ğŸ’¡ è§‰å¾—è¿™ä¸ªæ¸¸æˆå¤ªç®€å•äº†? æ‹œæ‰˜! ä½ è¿˜åªæ˜¯ä¸ªæ–°æ‰‹å¥½å§. æˆ‘ä»¬åé¢ä¼šæœ‰æ¸¸æˆç©æ³•è¶³å¤Ÿä¸°å¯Œçš„æ¸¸æˆ. ç­‰ä½ å­¦ä¼šäº†, å°±å¯ä»¥éšå¿ƒæ‰€æ¬²å¼€å‘å±äºè‡ªå·±çš„æ¸¸æˆå’¯!

## ä»“åº“åœ°å€

åœ¨[Github](https://github.com/HarrisonQi/flame-tutorial-boxgame)æˆ–[ç äº‘](https://gitee.com/HarrisonQI/flame-tutorial-boxgame)æŸ¥çœ‹æœ¬ç¯‡æ–‡ç« çš„å…¨éƒ¨ä»£ç 

## ç»“è¯­

å¦‚æœä½ å‡ºç°äº†ä¸æ‡‚çš„åœ°æ–¹, ä¸è¦çŠ¹è±«, æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€! ä¹Ÿæ¬¢è¿ä½ åŠ å…¥[æˆ‘çš„Flameäº¤æµç¾¤(QQ)](https://jq.qq.com/?_wv=1027&k=5ETLFm3)

## æ„Ÿè°¢

- æœ¬ç« å†…å®¹çµæ„Ÿéƒ¨åˆ†æ¥æºäºå®˜æ–¹æ–‡æ¡£[ã€ŠCreate a Mobile Game with Flutter and Flame â€“ Beginner Tutorialã€‹](https://jap.alekhin.io/create-mobile-game-flutter-flame-beginner-tutorial)
- flame [githubä»“åº“åœ°å€](https://github.com/flame-engine/flame)
- pub.dev [å®˜æ–¹ç½‘å€](https://pub.flutter-io.cn/packages/flame)
- **[Pexels](https://www.pexels.com/zh-cn/photo/1484759/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)**Â ä¸Šçš„Â **[Steve Johnson](https://www.pexels.com/zh-cn/@steve?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)**Â æ‹æ‘„çš„ç…§ç‰‡

æœ€æ–°ã€æ›´å¤šã€æ›´å¥½çš„æ•™ç¨‹/åšå®¢/èµ„è®¯, æ¬¢è¿è®¿é—®æˆ‘çš„å®˜ç½‘: [é˜¿èˆªçš„æŠ€æœ¯å°ç«™](https://blog.bugcatt.com)
